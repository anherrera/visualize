<style type="text/css">
    * { margin: 0; padding: 0;}
    #canvas {
        display: block;
        background: #000;
    }
</style>

<canvas id="canvas"></canvas>

<script type="text/javascript">
    window.onload = function(){
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        // canvas - full width and height of the page
        var W = window.innerWidth, H = window.innerHeight;
        canvas.width = W;
        canvas.height = H;

        // set the center of our "circle" to the middle of hte canvas.
        circleCenterX = W/2;
        circleCenterY = H/2;

        // the opacity of the mask that layers over the drawings
        fadeOutConstant = 0.02;

        // Make some particles
        var particles = [];
        var connectionMap = [];
        var numOfPointsPerLayer = 3;
        var radiusLayers = [
            {
                radius: 200,
                direction: 'cw'
            },
            {
                radius: 400,
                direction: 'ccw'
            },
            {
                radius: 600,
                direction: 'cw'
            }
        ];

        for (var i = 0; i < numOfPointsPerLayer; i++) {
            for (var n = 0; n < radiusLayers.length; n++) {
                var angle = i * 2*Math.PI/numOfPointsPerLayer;
                var newParticle = new particle(angle, radiusLayers[n].radius, radiusLayers[n].direction);
                particles.push(newParticle);
            }
        }

        generateConnectionMap(particles);

        console.log(connectionMap);

        // Find x coordinates of point on the circle given angle (uses circleRadius)
        function findX(angle, radius) {
            return circleCenterX + radius * Math.cos(angle);
        }

        // Find y coordinates of point on the circle given angle (uses circleRadius)
        function findY(angle, radius) {
            return circleCenterY + radius * Math.sin(angle);
        }

        function particle(angle, radius, direction)
        {
            var x = findX(angle, radius);
            var y = findY(angle, radius);

            this.radius = radius;

            this.direction = direction;

            // coordinates
            this.location = {x: x, y: y};

            // radius of the particle - zero for invisible
            this.size = 0;

            // speed at which it moves around the "circle"
            this.speed = 3;

            // angle placement along the circle
            this.angle = angle;

            // the particle will have a random color, which will determined
            // the color of the line that gets drawn.
            var r = Math.round(Math.random()*255);
            var g = Math.round(Math.random()*255);
            var b = Math.round(Math.random()*255);
            this.rgba = "rgba("+r+", "+g+", "+b+", 1)";
        }

        function generateConnectionMap(particles) {
            connectionMap = [];
            var total = particles.length;

            for (var i = 0; i < total; i++) {
                for (var n = i+1; n < total; n++) {
                    connectionMap.push({
                        x1: particles[i].location.x,
                        y1: particles[i].location.y,
                        x2: particles[n].location.x,
                        y2: particles[n].location.y,
                        rgba: particles[i].rgba
                    });
                }
            }
        }

        // connect all the particles and move them
        function draw()
        {
            // fill the mask in over existing drawings
            ctx.globalCompositeOperation = "source-over";
            ctx.fillStyle = "rgba(0, 0, 0, "+ fadeOutConstant +")";
            ctx.fillRect(0, 0, W, H);
            ctx.globalCompositeOperation = "lighter";

            for (var j = 0; j < connectionMap.length; j++) {
                var connection = connectionMap[j];

                ctx.beginPath();
                ctx.lineWidth = 1;
                ctx.moveTo(connection.x1, connection.y1);
                ctx.lineTo(connection.x2, connection.y2);
                //ctx.quadraticCurveTo(connection.x2, connection.y2, circleCenterX, circleCenterY);
                ctx.strokeStyle = connection.rgba;
                ctx.stroke();
            }

            for(var i = 0; i < particles.length; i++)
            {
                var p = particles[i];
                ctx.fillStyle = "white";
                ctx.fillRect(p.location.x, p.location.y, p.size, p.size);

                // move the particles around our circle
                if (p.direction == 'cw') {
                    p.angle = p.angle + p.speed*2*Math.PI/360;
                } else {
                    p.angle = p.angle - p.speed*2*Math.PI/360;
                }

                if (p.angle >= Math.PI*2) {
                    p.angle = 0;
                }

                particles[i].angle = p.angle;
                particles[i].radius = p.radius;
                particles[i].location.x = findX(p.angle, p.radius);
                particles[i].location.y = findY(p.angle, p.radius);
            }

            generateConnectionMap(particles);


            // semi-randomly take or add particles
            /*if (Math.random() > .9) {
                particles.push(new particle(2*Math.PI*Math.random()));
            } else {
                if (particles.length > numOfPoints) {
                    particles.shift();
                }
            }*/

            //circleRadius = Math.random() * origCircleRadius;
            //p.radius = Math.cos(p.angle) * p.origRadius;
        }

        setInterval(draw, 30);
        //draw();
    }
</script>
